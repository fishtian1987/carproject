/*
*********************************************************************************************************
*	                                  
*	模块名称 : 系统设定模块
*	文件名称 : sys.c
*	版    本 : V1.3
*	说    明 : 系统设定模块
*
*
*********************************************************************************************************
*/

#include "sys.h"  
#include "FreeRTOS.h"	

/*
*********************************************************************************************************
*	函 数 名: WFI_SET
*	功能说明: THUMB指令不支持汇编内联
						采用如下方法实现执行汇编指令WFI  
*	形    参：无
*	返 回 值: 无
*********************************************************************************************************
*/
__asm void WFI_SET(void)
{
	WFI;		  
}

/*
*********************************************************************************************************
*	函 数 名: INTX_DISABLE
*	功能说明: 关闭所有中断(但是不包括fault和NMI中断)
*	形    参：无
*	返 回 值: 无
*********************************************************************************************************
*/
__asm void INTX_DISABLE(void)
{
	CPSID   I
	BX      LR	  
}

/*
*********************************************************************************************************
*	函 数 名: INTX_ENABLE
*	功能说明: 开启所有中断
*	形    参：无
*	返 回 值: 无
*********************************************************************************************************
*/
__asm void INTX_ENABLE(void)
{
	CPSIE   I
	BX      LR  
}

/*
*********************************************************************************************************
*	函 数 名: MSR_MSP
*	功能说明: 设置栈顶地址
*	形    参：addr,栈顶地址
*	返 回 值: 无
*********************************************************************************************************
*/
__asm void MSR_MSP(u32 addr) 
{
	MSR MSP, r0
	BX r14
}

#if 1
#pragma import(__use_no_semihosting)             
               
struct __FILE 
{ 
	int handle; 
}; 

FILE __stdout;       
  
void _sys_exit(int x) 
{ 
	x = x; 
} 

int fputc(int ch, FILE *f)
{ 	
	while((USART1->SR&0X40)==0);   
	USART1->DR = (u8) ch;      
	return ch;
}
#endif

